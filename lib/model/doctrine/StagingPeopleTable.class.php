<?php

/**
 * StagingPeopleTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class StagingPeopleTable extends Doctrine_Table
{
  /**
   * Returns an instance of this class.
   *
   * @return object StagingPeopleTable
   */
  public static function getInstance()
  {
      return Doctrine_Core::getTable('StagingPeople');
  }
  
  public function getPeopleInError($staging_ref)
  {
    // if $staging ref is an array, then it's an list of identification
    if(is_array($staging_ref)) $relation = "identifications" ; 
    else $relation = "staging";
    $q = Doctrine_Query::create()
      ->from('StagingPeople s')         
      ->where('s.referenced_relation = ?',$relation) 
      ->addWhere('s.people_ref is null') ;
    if(is_array($staging_ref)) $q->andWhereIn('s.record_id',$staging_ref) ;
    else $q->addWhere('s.record_id = ?',$staging_ref) ;      
    return $q->execute() ;      
  }
  
  public function UpdatePeopleRef($people)
  {
    $q = Doctrine_Query::create()
      ->update('StagingPeople s')
      ->set('s.people_ref',$people['people_ref'])
      ->where('s.id = ?',$people['id']) ;
    return $q->execute() ;   
  }    
}
